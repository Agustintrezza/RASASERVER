version: "3.1"

intents:
  - greet
  - goodbye
  - affirm
  - deny
  - mood_great
  - mood_unhappy
  - bot_challenge
  - select_category
  - select_product
  - go_back
  - start_reservation    # ğŸš¨ Agregado para iniciar el formulario

slots:
  dynamic_categories:
    type: any
    influence_conversation: false
    mappings:
      - type: custom

  selected_category:
    type: text
    influence_conversation: false
    mappings:
      - type: custom

  dynamic_products:
    type: any
    influence_conversation: false
    mappings:
      - type: custom

  selected_product:
    type: any
    influence_conversation: false
    mappings:
      - type: custom

  navigation_step:
    type: text
    influence_conversation: false
    mappings:
      - type: custom

  # ğŸ”¥ Slot para menÃº combinado categorÃ­as + secciones
  menu_items:
    type: any
    influence_conversation: false
    mappings:
      - type: custom

  # ğŸ”¥ Slot para guardar quÃ© secciÃ³n eligiÃ³ el usuario
  selected_section:
    type: text
    influence_conversation: false
    mappings:
      - type: custom

  name:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
          - active_loop: reservation_form
            requested_slot: name

  date:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
          - active_loop: reservation_form
            requested_slot: date

  people:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
          - active_loop: reservation_form
            requested_slot: people

  phone:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text
        conditions:
          - active_loop: reservation_form
            requested_slot: phone

  reservation_confirmation:
    type: bool
    influence_conversation: false
    mappings:
      - type: from_intent
        intent: affirm
        value: true
      - type: from_intent
        intent: deny
        value: false

forms:
  reservation_form:
    required_slots:
      - name
      - date
      - people
      - phone

responses:
  utter_goodbye:
    - text: "Â¡AdiÃ³s! ğŸ‘‹ Que tengas un excelente dÃ­a."

  utter_ask_rephrase:
    - text: "DisculpÃ¡, no entendÃ­. Â¿PodrÃ­as reformular tu mensaje?"

  utter_ask_name:
    - text: "Â¿CuÃ¡l es tu nombre completo para la reserva?"

  utter_ask_date:
    - text: "Â¿QuÃ© fecha preferÃ­s para la reserva? (Formato: DD/MM/AAAA)"

  utter_ask_people:
    - text: "Â¿Para cuÃ¡ntas personas querÃ©s reservar?"

  utter_ask_phone:
    - text: "Â¿PodrÃ­as indicarme tu nÃºmero de telÃ©fono para poder comunicarnos, por favor?"

  utter_ask_reservation_confirmation:
    - text: |
        ğŸ” *Por favor, confirmÃ¡ los datos de tu reserva:*
        ğŸ‘¤ Nombre: {name}
        ğŸ“… Fecha: {date}
        ğŸ‘¥ Personas: {people}
        ğŸ“ TelÃ©fono: {phone}

        Â¿Es correcto?
      buttons:
        - title: "âœ… SÃ­"
          payload: "/affirm"
        - title: "âŒ No"
          payload: "/deny"

  utter_submit_reservation:
    - text: "Â¡Gracias {name}! ğŸ“ Tu reserva para {people} personas el dÃ­a {date} fue procesada con Ã©xito. ğŸ—“ï¸ A la brevedad un asesor se pondrÃ¡ en contacto contigo al {phone}. ğŸ“"

  utter_cancel_reservation:
    - text: "No hay problema. Si querÃ©s reservar mÃ¡s tarde, Â¡acÃ¡ estarÃ©!"

  utter_ask_if_wants_reservation:
    - text: "Â¿QuerÃ©s reservar este producto?"
      buttons:
        - title: "âœ… SÃ­"
          payload: "/start_reservation"
        - title: "âŒ No"
          payload: "/deny"

actions:
  - action_fetch_main_menu
  - action_handle_option
  - action_fetch_products
  - action_go_back
  - action_handle_product
  - validate_reservation_form
  - action_ask_reservation_confirmation
  - action_reset_reservation_slots
  - action_fetch_section_details   # ğŸš¨ Nueva action para mostrar detalle de la secciÃ³n
